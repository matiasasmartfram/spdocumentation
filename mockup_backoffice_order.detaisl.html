<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mockup Pedido v2.2 - Footer Detallado</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    body {
      background-color: #f8fafc;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    /* Animaciones del Acordeón */
    .accordion-content {
      transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
      max-height: 0;
      opacity: 0;
      overflow: hidden;
    }
    
    .accordion-content.open {
      max-height: 2000px;
      opacity: 1;
    }

    .rotate-icon {
      transition: transform 0.3s ease;
    }
    
    .rotate-icon.rotated {
      transform: rotate(180deg);
    }

    /* GRID LAYOUT (SKU a la izquierda) */
    .grid-row {
      display: grid;
      grid-template-columns: 0.7fr 3fr 0.6fr 1fr 1fr; 
      align-items: center;
      column-gap: 1rem;
    }
  </style>
</head>
<body class="p-4 md:p-10">

  <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-xl overflow-hidden border border-gray-200">
    
    <!-- Header -->
    <div class="bg-slate-900 text-white text-xs uppercase font-bold py-4 px-6 grid-row tracking-wider">
      <div>SKU</div>
      <div>Descripción</div>
      <div class="text-center">Cant.</div>
      <div class="text-right">Precio Base</div>
      <div class="text-right">Total</div>
    </div>

    <!-- Contenedor Dinámico -->
    <div id="order-container" class="divide-y divide-gray-100"></div>

    <!-- Footer Totales (Actualizado según imagen) -->
    <div class="bg-white p-6 border-t border-gray-200">
      <div class="flex flex-col items-end gap-1 text-sm">
        
        <!-- Envío -->
        <div class="flex items-center justify-end w-full md:w-1/3">
          <span class="font-bold text-gray-900 mr-2">Envío</span>
          <span class="font-bold text-green-600" id="shipping-val">+$0</span>
        </div>

        <!-- Subtotal -->
        <div class="flex items-center justify-end w-full md:w-1/3">
          <span class="font-bold text-gray-900 mr-2">Subtotal</span>
          <span class="font-bold text-gray-900" id="sub-total">$0</span>
        </div>

        <!-- Descuento -->
        <div class="flex items-center justify-end w-full md:w-1/3">
          <span class="font-bold text-gray-900 mr-2">Descuento</span>
          <span class="font-bold text-red-500" id="discount-val">-$0</span>
        </div>

        <!-- Separador -->
        <div class="border-b border-gray-200 w-full md:w-1/3 my-1"></div>

        <!-- Total -->
        <div class="flex items-center justify-end w-full md:w-1/3">
          <span class="font-bold text-gray-900 mr-2 text-base">Total</span>
          <span class="font-extrabold text-gray-900 text-lg" id="final-total">$0</span>
        </div>

      </div>
    </div>

  </div>

  <script>
    // --- VARIABLES GLOBALES DE PEDIDO (Simuladas) ---
    const GLOBAL_SHIPPING_COST = 0; // Cambiar a 1500 para probar
    const GLOBAL_DISCOUNT = 0;      // Cambiar a 5000 para probar

    // --- DATOS JSON ---
    const orderData = {
      "details": [
        {
          "itemType": "COMBO",
          "itemId": "10001",
          "sku": "10001",
          "itemDescription": "Combo 1 - Crispy",
          "price": 19900,
          "discount": 0,
          "quantity": 1,
          "customizations": null,
          "includedItems": [
            {
              "itemType": "PRODUCT",
              "itemId": "27",
              "sku": "27",
              "itemDescription": "Burguer Crispy",
              "price": 0,
              "discount": 0,
              "quantity": 1,
              "customizations": {
                "observation": "",
                "removedComponents": [
                  { "itemType": "COMPONENT", "itemId": "26", "sku": "26", "itemDescription": "Sin tomate", "price": 0, "quantity": 1 }
                ],
                "extras": [
                  { "itemType": "COMPONENT", "itemId": "1", "sku": "1", "itemDescription": "Extra Medallon de Carne", "price": 3000, "quantity": 1 }
                ]
              }
            },
            { "itemType": "PRODUCT", "itemId": "12", "sku": "12", "itemDescription": "Papas fritas", "price": 0, "quantity": 1, "customizations": null },
            { "itemType": "PRODUCT", "itemId": "4", "sku": "4", "itemDescription": "Pepsi", "price": 0, "quantity": 1, "customizations": null }
          ]
        },
        {
          "itemType": "COMBO",
          "itemId": "10001",
          "sku": "10001",
          "itemDescription": "Combo 1 - Gulosa",
          "price": 19900,
          "discount": 0,
          "quantity": 1,
          "customizations": {
            "observation": "Sin sal porfavor"
          },
          "includedItems": [
            { "itemType": "PRODUCT", "itemId": "9", "sku": "9", "itemDescription": "Gulosa", "price": 0, "quantity": 1, "customizations": null },
            { "itemType": "PRODUCT", "itemId": "104", "sku": "104", "itemDescription": "H2O Pomelo", "price": 0, "quantity": 1, "customizations": null },
            { "itemType": "PRODUCT", "itemId": "12", "sku": "12", "itemDescription": "Papas fritas", "price": 0, "quantity": 1, "customizations": null },
            { "itemType": "PRODUCT", "itemId": "164", "sku": "164", "itemDescription": "Helado Paleta Frutilla", "price": 4000, "quantity": 1, "customizations": null }
          ]
        },
        {
          "itemType": "PRODUCT",
          "itemId": "9",
          "sku": "9",
          "itemDescription": "Gulosa",
          "price": 12000,
          "discount": 0,
          "quantity": 1,
          "customizations": {
            "observation": "Sin sal porfavor",
            "removedComponents": [],
            "extras": []
          },
          "includedItems": null
        },
        { "itemType": "PRODUCT", "itemId": "12", "sku": "12", "itemDescription": "Papas fritas", "price": 4000, "quantity": 1, "customizations": null },
        { "itemType": "PRODUCT", "itemId": "4", "sku": "4", "itemDescription": "Pepsi", "price": 4000, "quantity": 2, "customizations": null }
      ]
    };

    // --- UTILIDADES ---
    // Usamos fractionDigits 0 para que no muestre decimales, igual que en la imagen
    const formatMoney = (amount) => {
      return new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS', minimumFractionDigits: 0 }).format(amount);
    };
    
    // Formateador simple para los valores + y - sin simbolo de moneda repetido si se prefiere
    const formatValue = (amount) => {
       return "$" + amount.toLocaleString('es-AR');
    };

    function calculateEffectiveUnitPrice(item) {
      let total = item.price;
      if (item.includedItems) {
        item.includedItems.forEach(child => {
           total += child.price;
           if (child.customizations?.extras) {
             child.customizations.extras.forEach(extra => {
               total += extra.price;
             });
           }
        });
      }
      if (item.customizations?.extras) {
        item.customizations.extras.forEach(extra => {
          total += extra.price;
        });
      }
      return total;
    }

    // --- RENDERIZADO ---

    function renderOrderList(details) {
      const container = document.getElementById('order-container');
      let itemsSubtotal = 0;

      details.forEach(item => {
        const effectiveUnitPrice = calculateEffectiveUnitPrice(item);
        const rowTotal = effectiveUnitPrice * item.quantity;
        itemsSubtotal += rowTotal;

        const itemRow = createItemRow(item, 'root', 1, effectiveUnitPrice);
        container.appendChild(itemRow);
      });

      // Calculos Finales del Footer
      const finalTotal = itemsSubtotal + GLOBAL_SHIPPING_COST - GLOBAL_DISCOUNT;

      // Inyección en el DOM
      document.getElementById('shipping-val').textContent = `+${formatValue(GLOBAL_SHIPPING_COST)}`;
      document.getElementById('sub-total').textContent = formatValue(itemsSubtotal);
      document.getElementById('discount-val').textContent = `-${formatValue(GLOBAL_DISCOUNT)}`;
      document.getElementById('final-total').textContent = formatValue(finalTotal);
    }

    function createItemRow(item, type = 'root', parentQty = 1, effectiveTotalOverride = null) {
      const hasIncluded = item.includedItems && item.includedItems.length > 0;
      const hasRemoved = item.customizations?.removedComponents?.length > 0;
      const hasExtras = item.customizations?.extras?.length > 0;
      const hasObservation = item.customizations?.observation && item.customizations.observation.length > 0;
      const hasChildren = hasIncluded || hasRemoved || hasExtras || hasObservation;

      // Estilos
      let bgColor = type === 'root' ? 'bg-white hover:bg-gray-50' : 'bg-slate-50 border-t border-gray-100';
      // Indentación en la columna Descripción
      let indentClass = type === 'root' ? 'pl-0' : 'pl-8'; 
      let titleClass = type === 'root' ? 'font-bold text-gray-800 text-base' : 'font-medium text-gray-700 text-sm';
      let badgeHTML = '';

      if (type === 'included') {
        if (item.price > 0) {
           badgeHTML = `<span class="bg-yellow-100 text-yellow-800 text-[10px] font-bold px-2 py-0.5 rounded uppercase mr-2 border border-yellow-200">Extra</span>`;
        } else {
           badgeHTML = `<span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-0.5 rounded uppercase mr-2 border border-blue-200">Incluye</span>`;
        }
      }

      const currentTotalRowPrice = effectiveTotalOverride !== null 
                                   ? effectiveTotalOverride * item.quantity 
                                   : item.price * parentQty;

      // HTML Elements
      const containerDiv = document.createElement('div');
      containerDiv.className = 'group';

      const headerDiv = document.createElement('div');
      headerDiv.className = `${bgColor} grid-row py-4 px-6 transition-colors cursor-pointer relative`;
      
      const chevronIcon = hasChildren 
        ? `<i class="fa-solid fa-chevron-down text-gray-400 mr-2 text-xs rotate-icon group-hover:text-blue-500"></i>` 
        : `<span class="mr-5"></span>`; 

      // Precios y Cantidades
      let displayBasePrice = formatMoney(item.price);
      let displayTotalPrice = formatMoney(currentTotalRowPrice);
      let displayQty = type === 'root' ? item.quantity : (item.price > 0 ? parentQty : '<span class="text-gray-300">-</span>');

      if(item.price === 0 && type !== 'root') {
          displayBasePrice = '<span class="text-gray-300">$0</span>';
          if(currentTotalRowPrice === 0) displayTotalPrice = '<span class="text-gray-300">$0</span>';
      }

      const displaySku = item.sku ? item.sku : '-';

      headerDiv.innerHTML = `
        <div class="text-xs font-bold text-gray-500 break-all">${displaySku}</div>
        
        <div class="flex items-center ${indentClass}">
          ${chevronIcon}
          <div class="flex flex-col">
            <div class="flex items-center">
              ${badgeHTML}
              <span class="${titleClass}">${item.itemDescription}</span>
            </div>
          </div>
        </div>

        <div class="text-center text-sm font-medium text-gray-600">${displayQty}</div>
        <div class="text-right text-sm font-medium text-gray-500">${displayBasePrice}</div>
        <div class="text-right text-sm font-bold text-gray-800">${displayTotalPrice}</div>
      `;

      containerDiv.appendChild(headerDiv);

      // Contenido Desplegable
      if (hasChildren) {
        const contentDiv = document.createElement('div');
        contentDiv.className = 'accordion-content bg-gray-50 shadow-inner';
        
        // Observaciones
        if (hasObservation) {
            const obsRow = document.createElement('div');
            const indent = type === 'root' ? 'ml-[10%]' : 'ml-[15%]'; 
            obsRow.className = `py-2 px-6 border-l-4 border-amber-200 bg-amber-50/50 flex`;
            obsRow.innerHTML = `
                <div class="${indent} text-xs text-amber-800 italic font-medium w-full">
                    <i class="fa-regular fa-comment-dots mr-2"></i> Observación: "${item.customizations.observation}"
                </div>
            `;
            contentDiv.appendChild(obsRow);
        }

        // Recursividad (Hijos)
        if (hasIncluded) {
          item.includedItems.forEach(subItem => {
            contentDiv.appendChild(createItemRow(subItem, 'included', item.quantity));
          });
        }

        // Customizations
        const detailIndent = type === 'root' ? 'pl-8' : 'pl-16';

        if (hasRemoved) {
          item.customizations.removedComponents.forEach(rem => {
            contentDiv.appendChild(createDetailRow(rem, 'removed', detailIndent));
          });
        }
        if (hasExtras) {
          item.customizations.extras.forEach(ext => {
             contentDiv.appendChild(createDetailRow(ext, 'extra', detailIndent, item.quantity));
          });
        }

        containerDiv.appendChild(contentDiv);

        headerDiv.addEventListener('click', () => {
          contentDiv.classList.toggle('open');
          const icon = headerDiv.querySelector('.rotate-icon');
          if(icon) icon.classList.toggle('rotated');
        });
      }

      return containerDiv;
    }

    function createDetailRow(detail, type, paddingClass, parentQty = 1) {
      const row = document.createElement('div');
      row.className = `grid-row py-2 px-6 border-l border-dotted border-gray-300`;
      
      let badge = '';
      let price = '$0';
      let total = '$0';
      let textClass = 'text-gray-600';

      if (type === 'removed') {
        badge = `<span class="bg-red-100 text-red-600 text-[10px] font-bold px-2 py-0.5 rounded uppercase mr-2 border border-red-200">Opcional</span>`;
        textClass = 'text-gray-500 italic'; 
      } else if (type === 'extra') {
        badge = `<span class="bg-emerald-100 text-emerald-700 text-[10px] font-bold px-2 py-0.5 rounded uppercase mr-2 border border-emerald-200">Extra</span>`;
        price = formatMoney(detail.price);
        total = formatMoney(detail.price * parentQty);
        textClass = 'text-gray-700 font-medium';
      }

      const skuDisplay = detail.sku ? detail.sku : '';

      row.innerHTML = `
        <div class="text-xs text-gray-400 font-medium">${skuDisplay}</div>
        
        <div class="flex items-center ${paddingClass}">
          ${badge}
          <span class="text-xs ${textClass}">${type === 'removed' ? 'Sin ' : ''}${detail.itemDescription}</span>
        </div>

        <div class="text-center text-xs text-gray-400">-</div>
        <div class="text-right text-xs text-gray-500">${price}</div>
        <div class="text-right text-xs text-gray-500">${total}</div>
      `;
      return row;
    }

    // Inicializar
    renderOrderList(orderData.details);

  </script>
</body>
</html>
