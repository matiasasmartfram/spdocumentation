<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integraci√≥n de Cat√°logo: SmartCloud ‚Üî SmartPedidos</title>
    <style>
        /* RESET & BASICS */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* LAYOUT */
        header {
            background-color: #0056b3;
            color: white;
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }

        .layout-container {
            display: flex;
            margin-top: 60px;
            height: calc(100vh - 60px);
        }

        /* SIDEBAR (TOC) */
        .sidebar {
            width: 300px;
            background-color: #fff;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            padding: 2rem 1rem;
            flex-shrink: 0;
        }

        .sidebar h3 {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
        }

        .sidebar li {
            margin-bottom: 0.5rem;
        }

        .sidebar a {
            text-decoration: none;
            color: #444;
            font-size: 0.9rem;
            display: block;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .sidebar a:hover {
            background-color: #f0f4f8;
            color: #0056b3;
        }

        .sidebar .sub-item {
            padding-left: 20px;
            font-size: 0.85rem;
        }

        /* MAIN CONTENT */
        .content {
            flex-grow: 1;
            padding: 3rem 4rem;
            overflow-y: auto;
            background-color: #fff;
            max-width: 100%;
            scroll-behavior: smooth;
        }

        .content-wrapper {
            max-width: 900px;
            margin: 0 auto;
        }

        /* TYPOGRAPHY */
        h1 {
            font-size: 2.2rem;
            color: #111;
            margin-bottom: 1rem;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        h2 {
            font-size: 1.6rem;
            color: #2c3e50;
            margin-top: 3rem; /* M√°s espacio para separar secciones principales */
            margin-bottom: 1rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        h3 {
            font-size: 1.3rem;
            color: #34495e;
            margin-top: 2rem;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }

        h4 {
            font-size: 1.1rem;
            color: #555;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        p {
            margin-bottom: 1rem;
            color: #444;
        }

        strong {
            color: #000;
            font-weight: 700;
        }

        /* LISTS */
        ul,
        ol {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        /* TABLES */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.95rem;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f4f6f8;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        /* CODE BLOCKS (VS CODE STYLE) */
        pre {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
            position: relative;
            border-left: 4px solid #007acc;
        }

        code {
            font-family: inherit;
        }

        /* SYNTAX HIGHLIGHTING COLORS */
        .json-key { color: #9cdcfe; }      /* Light Blue */
        .json-string { color: #ce9178; }   /* Orange/Coral */
        .json-number { color: #b5cea8; }   /* Light Green */
        .json-boolean { color: #569cd6; }  /* Blue */
        .json-null { color: #569cd6; }     /* Blue */
        .json-comment { color: #6a9955; }  /* Green */

        /* UTILS */
        .divider {
            height: 1px;
            background: #e0e0e0;
            margin: 3rem 0;
        }

        .tag {
            display: inline-block;
            background: #e1ecf4;
            color: #39739d;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .layout-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
                padding: 1rem;
            }

            .content {
                padding: 1.5rem;
            }

            header {
                position: relative;
            }

            .layout-container {
                margin-top: 0;
                height: auto;
            }
        }
    </style>
</head>

<body>

    <header>
        <h1>Integraci√≥n de Cat√°logo: SmartCloud ‚Üî SmartPedidos</h1>
    </header>

    <div class="layout-container">
        <!-- SIDEBAR INDEX -->
        <nav class="sidebar">
            <h3>√çndice de Contenidos</h3>
            <ul>
                <li>
                    <a href="#obj-context">1. Objetivo y Contexto</a>
                    <ul>
                        <li><a href="#req-smartcloud" class="sub-item">1.1. Requerimientos SmartCloud</a></li>
                        <li><a href="#flow" class="sub-item">1.2. Flujo de Proceso</a></li>
                        <li><a href="#json-spec" class="sub-item">1.3. Especificaci√≥n JSON Unificado</a></li>
                    </ul>
                </li>

                <li>
                    <a href="#req-detailed">2. Requerimientos</a>
                    <ul>
                        <li><a href="#det-2-1" class="sub-item">2.1. Tipificaci√≥n Listas</a></li>
                        <li><a href="#det-2-2" class="sub-item">2.2. Gesti√≥n Multimedia</a></li>
                        <li><a href="#det-2-3" class="sub-item">2.3. Integraci√≥n Promociones</a></li>
                    </ul>
                </li>

                <li>
                    <a href="#spec-tech">3. Especificaci√≥n T√©cnica Detallada</a>
                    <ul>
                        <li><a href="#det-3-1" class="sub-item">3.1. Estructura General</a></li>
                        <li><a href="#det-3-2" class="sub-item">3.2. Contexto y Ruteo</a></li>
                        <li><a href="#det-3-3" class="sub-item">3.3. Productos Unitarios</a></li>
                        <li><a href="#det-3-4" class="sub-item">3.4. Relaciones y Promociones</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- MAIN CONTENT -->
        <main class="content">
            <div class="content-wrapper">

                <section id="intro">
                    <h1>Integraci√≥n de Cat√°logo: SmartCloud ‚Üî SmartPedidos</h1>
                    <p>Este documento define la arquitectura de integraci√≥n y el contrato de datos para la
                        sincronizaci√≥n autom√°tica de cat√°logos.</p>
                </section>

                <!-- SECCI√ìN 1 -->
                <section id="obj-context">
                    <h2>1. Objetivo y Contexto del Negocio</h2>
                    <p>El objetivo es automatizar la distribuci√≥n de cambios de precios y productos. Se busca unificar
                        la experiencia de modo que cuando un administrador en SmartCloud presione <strong>"Publicar
                            Lista de Precios"</strong>, el sistema autom√°ticamente compile toda la informaci√≥n necesaria
                        y la env√≠e a SmartPedidos.</p>

                    <h3 id="req-smartcloud">1.1. Requerimientos para SmartCloud</h3>
                    <p>Para lograr este payload unificado, SmartCloud debe contar con las siguientes l√≥gicas de negocio:
                    </p>
                    <ul>
                        <li><strong>Tipificaci√≥n de Listas de Precio:</strong> Capacidad de asignar
                            <strong>Canal</strong> (Ej: Delivery) y <strong>SubCanal</strong> (Ej: PedidosYa) en la
                            configuraci√≥n de la lista.
                        </li>
                        <li><strong>Im√°genes por Plataforma:</strong> Selector de <strong>Plataforma</strong> en el
                            m√≥dulo Multimedia para filtrar la imagen correcta (Ej: Tag "PedidosYa" con fondo blanco
                            4:3).</li>
                    </ul>

                    <h3 id="flow">1.2. Flujo de Proceso de Publicaci√≥n</h3>
                    <p>El proceso es un modelo <strong>PUSH</strong> disparado por evento:</p>
                    <ol>
                        <li><strong>Disparador:</strong> Usuario hace clic en "Publicar" sobre una Lista de Precios.
                        </li>
                        <li><strong>Resoluci√≥n de Contexto:</strong> SmartCloud identifica la Plataforma (Ej: PedidosYa)
                            y los <strong>BranchIds</strong> afectados.</li>
                        <li><strong>Compilaci√≥n de Datos:</strong>
                            <ul>
                                <li><strong>Catalog:</strong> Obtiene items habilitados y resuelve sus
                                    <strong>imageUrl</strong> seg√∫n el tag de plataforma.
                                </li>
                                <li><strong>Relations:</strong> Obtiene los combos v√°lidos y calcula sus precios
                                    finales.</li>
                            </ul>
                        </li>
                        <li><strong>Env√≠o:</strong> SmartCloud realiza un <strong>POST</strong> al webhook de
                            SmartPedidos con el JSON unificado.</li>
                    </ol>

                    <h3 id="json-spec">1.3. Especificaci√≥n del JSON Unificado (Payload)</h3>
                    <p>Este JSON es el <strong>entregable final</strong>. Contiene la "verdad absoluta" del cat√°logo
                        para las tiendas indicadas en la cabecera.</p>
                    <p><strong>Cambio Estructural:</strong> Se separan los productos unitarios (catalog) de las
                        estructuras compuestas/promocionales (relations).</p>

                    <h4>Ejemplo de Estructura JSON</h4>
<pre><code class="language-json">{
    "traceKey": "guid-evento-12345",
    "publishDate": "2025-11-30T10:00:00Z",
    "context": {
        "priceListId": 2,
        "platformId": 1,
        "platformName": "PedidosYa",
        "targetBranchIds": [
            5542,
            3365,
            2835
        ]
    },
    "catalog": [
        {
            "type": "item",
            "data": {
                "itemId": 5,
                "name": "Cerveza Corona",
                "publishedPrice": 4000.00,
                "enabled": true,
                "imageUrl": "https://cdn.smartcloud.com/images/peya/corona_4x3.jpg",
                "group": {
                    "name": "Bebidas Con Alcohol"
                },
                "composition": null
            }
        },
        {
            "type": "item",
            "data": {
                "itemId": 165,
                "name": "Mexicana",
                "publishedPrice": 14900.00,
                "enabled": true,
                "imageUrl": "https://cdn.smartcloud.com/images/peya/mexicana_4x3.jpg",
                "group": {
                    "name": "Signature Burgers"
                },
                "composition": {
                    "items": [
                        {
                            "id": 16,
                            "name": "Extra Cheddar",
                            "price": 1000.00,
                            "type": "extra"
                        },
                        {
                            "id": 74,
                            "name": "S.Palta",
                            "price": 0.00,
                            "type": "removable"
                        }
                    ]
                }
            }
        }
    ],
    "relations": [
        {
            "type": "promo",
            "data": {
                "promoId": 3,
                "sku": "10001",
                "name": "Combo 1",
                "description": "Combo 1 (burger, gaseosa y side)",
                "price": 16900.00,
                "imageUrl": "https://cdn.smartcloud.com/images/peya/combo1_4x3.jpg",
                "groups": [
                    {
                        "name": "Hamburguesa",
                        "min": 1,
                        "max": 1,
                        "options": [
                            {
                                "itemId": 87,
                                "name": "Bacon A Lo Tomi"
                            },
                            {
                                "itemId": 60,
                                "name": "Smack"
                            }
                        ]
                    }
                ]
            }
        }
    ]
}</code></pre>

                    <!-- Diccionario dejado bajo 1.3 como referencia -->
                    <h4>Diccionario de Datos del Payload</h4>
                    
                    <h5>A. Cabecera (context)</h5>
                    <p>Define el alcance de la actualizaci√≥n.</p>
                    <ul>
                        <li><strong>platformId:</strong> (Integer) ID interno de mapeo (1=PeYa, 2=Rappi).</li>
                        <li><strong>targetBranchIds:</strong> (Array) Lista de IDs de sucursales de SmartPedidos donde
                            impactar√° este cat√°logo.</li>
                    </ul>

                    <h5>B. Productos Unitarios (catalog)</h5>
                    <p>Array que contiene <strong>√∫nicamente</strong> objetos <code>type: "item"</code>.</p>
                    <p>Representa el inventario de productos vendibles por s√≠ mismos.</p>
                    <ul>
                        <li><strong>imageUrl:</strong> Debe venir populado con la URL p√∫blica final. SmartCloud
                            <strong>debe haber realizado el filtrado previo</strong> seleccionando la imagen
                            correspondiente a la plataforma del contexto.
                        </li>
                    </ul>

                    <h5>C. Relaciones y Promociones (relations)</h5>
                    <p>Array que contiene objetos <code>type: "promo"</code> o estructuras compuestas.</p>
                    <p>Representa Combos, Descuentos o Men√∫s que referencian a los items del <code>catalog</code> pero
                        tienen l√≥gica de agrupaci√≥n y precios propia.</p>
                </section>

                <div class="divider"></div>

                <!-- SECCI√ìN 2 -->
                <section id="req-detailed">
                    <h2>2. Requerimientos para SmartCloud</h2>
                    <p><strong>Solicitado por: Matias Avila</strong></p>

                    <h3 id="det-2-1">2.1. Tipificaci√≥n de Listas de Precios (Canal y SubCanal)</h3>
                    <h4>Situaci√≥n Actual</h4>
                    <p>Las listas de precios poseen una clasificaci√≥n gen√©rica (un solo nivel) y la asignaci√≥n al POS es
                        restrictiva (relaci√≥n 1 a 1).</p>

                    <h4>Modificaci√≥n Solicitada</h4>
                    <p><strong>Jerarqu√≠a de Canales:</strong> Debe soportar dos niveles de clasificaci√≥n:</p>
                    <ul>
                        <li><strong>Nivel 1 - Canal :</strong> Define el comportamiento inicial (Minorista, Mayorista,
                            Plataformas).</li>
                        <li><strong>Nivel 2 - SubCanal - :</strong> Define el destino espec√≠fico dentro de cada Canal
                            (PedidosYa, Salon, Ambulante‚Ä¶).</li>
                    </ul>
                    <p><strong>Asignaci√≥n M√∫ltiple en POS (1:N):</strong> Transformar la configuraci√≥n del POS para
                        permitir m√∫ltiples listas de precios simult√°neas.</p>

                    <h4>Justificaci√≥n</h4>
                    <p>Esta tipificaci√≥n habilita la logica de ruteo y formato de Multimedia (Imagenes) entre otros.</p>

                    <h4>Detalle Funcional y de Interfaz (UI/UX)</h4>
                    <p>La implementaci√≥n impacta en dos m√≥dulos clave del sistema:</p>

                    <p><strong>A. Configuraci√≥n de la Lista de Precios Manager</strong></p>
                    <p>En la pesta√±a "General", en Canal Comercial, se habilita el selector de Sub-Canal con las
                        siguientes opciones definidas:</p>
                    <ul>
                        <li>Canal - Minorista :
                            <ul>
                                <li>Sub Canal - Sal√≥n</li>
                                <li>Sub Canal - Ambulante</li>
                            </ul>
                        </li>
                        <li>Canal - Plataformas Delivery:
                            <ul>
                                <li>Sub Canal - PedidosYa</li>
                                <li>Sub Canal - Rappi</li>
                                <li>Sub Canal - UberEats</li>
                            </ul>
                        </li>
                        <li>Canal - Mayorista:
                            <ul>
                                <li>Sub Canal - Gastron√≥mico</li>
                                <li>Sub Canal - Corner</li>
                                <li>Sub Canal - Store</li>
                                <li>Sub Canal - Food Truck</li>
                            </ul>
                        </li>
                    </ul>
                    <p>üîó <em><a href="https://matiasasmartfram.github.io/spdocumentation/mockup_catalog_listadeprecios_manager.html" target="_blank">Ver Mockup: SmartCloud - Edici√≥n Lista de Precios</a></em></p>
                    <p>Nota: El mockup detalla la interacci√≥n de los selectores y visualizaci√≥n de los mismos.</p>

                    <p><strong>B. Asignacion de la Lista de Precios POS (Editar Punto de Venta)</strong></p>
                    <p>En la secci√≥n "Datos Pos", se reemplaza el campo √∫nico por un Configuraci√≥n de Listas de Precios.
                    </p>
                    <ul>
                        <li><strong>Selector Jer√°rquico:</strong> Flujo de selecci√≥n Canal -> SubCanal -> Lista.</li>
                        <li><strong>Grilla de Asignaciones:</strong> Tabla que visualiza todas las listas activas en el
                            POS, mostrando claramente el Canal y SubCanal de cada una mediante badges identificatorios.
                        </li>
                        <li><strong>Regla de Unicidad de SubCanal:</strong> Un POS puede tener m√∫ltiples listas
                            asignadas, pero nunca puede repetir la combinaci√≥n {Canal + SubCanal}.</li>
                        <li><strong>Mensaje de Error:</strong> "Ya existe una lista asignada para el Canal '{Canal}' y
                            SubCanal '{SubCanal}'. Debe eliminar la existente antes de asignar una nueva."</li>
                    </ul>
                   <p>üîó <em><a href="https://matiasasmartfram.github.io/spdocumentation/mockup_catalog_listadeprecios_POS.html" target="_blank">Ver Mockup: SmartCloud - Edici√≥n Lista de Precios POS</a></em></p>
                    <p>Nota: El mockup muestra la visualizacion de asignaciones y los mensajes de validaci√≥n.</p>

                    <h3 id="det-2-2">2.2. Gesti√≥n de Multimedia de Im√°genes</h3>
                    <h4>Situaci√≥n Actual</h4>
                    <p>Existe una relaci√≥n r√≠gida de 1 a 1 entre √çtem e Imagen. El sistema no valida requisitos
                        (resoluci√≥n, fondo, formato), lo que provoca que una misma imagen se env√≠e a todos los canales.
                    </p>

                    <h4>Modificaci√≥n Solicitada</h4>
                    <ul>
                        <li><strong>Relaci√≥n 1 a N:</strong> Permitir la carga de m√∫ltiples im√°genes por √≠tem,
                            clasificadas mediante un sistema de etiquetas basado en la taxonom√≠a de Canal y SubCanal
                            definida en el punto 2.1.</li>
                        <li><strong>Validaci√≥n Mediante Observaciones:</strong> Desplegar alertas visuales con los
                            requisitos t√©cnicos espec√≠ficos al momento de asignar una imagen a una plataforma.</li>
                        <li><strong>Resoluci√≥n Din√°mica en Publicaci√≥n:</strong> Al generar el JSON de la Lista de
                            Precios, el sistema debe inyectar din√°micamente la URL de la imagen que coincida con el
                            canal de destino.</li>
                    </ul>

                    <h4>Justificaci√≥n</h4>
                    <p>Garantiza que cada canal reciba el activo digital optimizado para su interfaz, evitando el
                        rechazo masivo de cat√°logos por parte de plataformas externas debido a incumplimiento de
                        est√°ndares gr√°ficos.</p>

                    <h4>Detalle Funcional y de Interfaz</h4>
                    <p>El m√≥dulo de Multimedia se redise√±a para gestionar asignaciones m√∫ltiples:</p>

                    <p><strong>A. Flujo de Carga y Asignaci√≥n</strong></p>
                    <ul>
                        <li><strong>Carga:</strong> El usuario sube el archivo o ingresa la URL.</li>
                        <li><strong>Asignaci√≥n:</strong> Selecciona el Canal (ej: Plataformas Delivery) y SubCanal (ej:
                            PedidosYa).</li>
                        <li><strong>Feedback:</strong> Al seleccionar el SubCanal, el sistema muestra un cuadro
                            informativo con las reglas de validaci√≥n reducidas.<br>
                            <em>Ejemplo Visual: "Requisitos PedidosYa: JPG/PNG, M√≠n 1440x1080px, Relaci√≥n 4:3."</em>
                        </li>
                        <li><strong>Visualizaci√≥n:</strong> Las im√°genes cargadas muestran Chips o etiquetas indicando a
                            qu√© canales est√°n asignadas.</li>
                    </ul>
                    <p>üîó <em><a href="https://matiasasmartfram.github.io/spdocumentation/mockup_catalog_item_multimedia.html" target="_blank">Ver Mockup: SmartCloud - Edici√≥n Lista de Precios Multimedia</a></em></p>
                    <p>Nota: El mockup ilustra la asignaci√≥n de tags y la visualizaci√≥n de requisitos t√©cnicos.</p>

                    <h4>Regla importante: Atributo ‚ÄúimageUrl‚Äù en JSON</h4>
                    <p>El atributo imageUrl del √≠tem se deberia resolver en el momento de la publicaci√≥n (Push) o
                        consulta (Pull) bas√°ndose en la configuraci√≥n de la Lista de Precios.</p>
                    <p><strong>Resoluci√≥n:</strong></p>
                    <ol>
                        <li>El sistema identifica el SubCanal de la Lista de Precios que se est√° procesando (ej:
                            PedidosYa).</li>
                        <li>Busca en la colecci√≥n de im√°genes del √≠tem aquella que tenga el Tag correspondiente a ese
                            SubCanal.</li>
                        <li>Si encuentra coincidencia, inyecta esa URL espec√≠fica en el payload.</li>
                        <li>Si no encuentra coincidencia espec√≠fica, utiliza la imagen marcada como "Default/Principal".
                        </li>
                    </ol>

                    <p><strong>Ejemplo de Salida JSON (Payload):</strong></p>
                    <p>Para una Lista de Precios configurada como "Plataformas Delivery -> PedidosYa":</p>
<pre><code class="language-json">{ 
    "itemId": 18, 
    "name": "Hamburguesa Doble", 
    "price": 12000, 
    // Imagen resuelta por SmartCloud filtrando por tag de Sub-Canal "PedidosYa" 
    "imageUrl": "https://cdn.smartcloud.com/images/pedidosya/burger_1440x1080_white_bg.jpg", 
    "modifications": [...] 
}</code></pre>

                    <p>Para una Lista de Precios configurada como "Plataformas Delivery -> Rappi":</p>
<pre><code class="language-json">{ 
    "itemId": 18, 
    "name": "Hamburguesa Doble", 
    "price": 12000, 
    // Imagen resuelta por SmartCloud filtrando por tag de Sub-Canal "Rappi" 
    "imageUrl": "https://cdn.smartcloud.com/images/rappi/burger_4x3_white_bg.rappi.jpg", 
    "modifications": [...] 
}</code></pre>

                    <p><strong>Caso: PedidosYa</strong></p>
                    <p>Para el SubCanal "PedidosYa", el sistema debe instruir al usuario v√≠a UI, al seleccionar
                        Plataforma de Pedidos ‚Üí Pedidos Ya:</p>
                    <p><em>"Requisito Excluyente: Formato Horizontal (4:3), M√≠nimo 1440x1080px. Formatos
                            JEPG/JPG/PNG."</em></p>

                    <h3 id="det-2-3">2.3. Integraci√≥n de Promociones y Combos</h3>
                    <h4>Situaci√≥n Actual</h4>
                    <p>SmartCloud no relacion a los √çtems y a las Promociones en la Lista de Precios.</p>
                    <ul>
                        <li>Items: Se obtienen v√≠a GetPrices (Lista de Precios).</li>
                        <li>Promociones: Se obtienen v√≠a GetByPOSCode (L√≥gica de POS).</li>
                    </ul>
                    <p>Esta separaci√≥n obliga a realizar m√∫ltiples llamadas.</p>

                    <h4>Modificaci√≥n Solicitada (Backend SmartCloud)</h4>
                    <p>El servicio de publicaci√≥n de Lista de Precios debe actuar como un Agregador.</p>
                    <p>Al publicar una Lista de Precios, debe:</p>
                    <ol>
                        <li><strong>Identificar Promociones Vinculadas:</strong> Buscar todas las promociones activas
                            que tengan asignada la PriceList que se est√° publicando.</li>
                        <li><strong>Transformar la Estructura:</strong> Convertir el modelo de datos interno de
                            Promociones (basado en GetByPOSCode) al esquema simplificado relations del JSON unificado.
                            <br><code>{ "type": "promo", "data": {...</code>
                        </li>
                        <li><strong>Inyectar en Payload:</strong> Anexar este array de promociones (objeto relations) al
                            mismo JSON que contiene los √≠tems individuales.</li>
                    </ol>
                </section>

                <div class="divider"></div>

                <!-- SECCI√ìN 3 -->
                <section id="spec-tech">
                    <h2>3. Especificaci√≥n T√©cnica Detallada</h2>
                    <p>Este JSON es el entregable final que SmartPedidos espera recibir. Contiene la Lista de Precios
                        (Items) + Las Promociones/Combos</p>

                    <h3 id="det-3-1">3.1. Estructura General del JSON</h3>
                    <p>El payload se divide en tres secciones: Cabecera (context), Productos Unitarios (catalog) y
                        Relaciones (relations).</p>
<pre><code class="language-json">{
  "traceKey": "guid-evento-12345",
  "publishDate": "2025-11-30T10:00:00Z",
  "context": { (Ver detalle 1.2)
    "priceListId": 2,
    "platformId": 1,
    "platformName": "PedidosYa",
    "targetBranchIds": [ 5542, 3365, 2835 ]
  },
  "catalog": [
    // Array de Items Unitarios (Ver detalle 1.3)
  ],
  "relations": [
    // Array de Promos y Combos (Ver detalle 1.4)
  ]
}</code></pre>

                    <h3 id="det-3-2">3.2. Contexto y Ruteo (context)</h3>
                    <p>Esta secci√≥n es para el enrutamiento del mensaje. Define qu√© plataforma recibe la data y a qu√©
                        sucursales espec√≠ficas debe impactar.</p>

                    <h4>Estructura del Objeto JSON</h4>
<pre><code class="language-json">"context": {
  "priceListId": 2,
  "platformId": 1,            // Mapeado seg√∫n tabla interna (Ej: 1 = PedidosYa)
  "platformName": "PedidosYa", // String legible
  "targetBranchIds": [ 5129, 5542 ] // IDs de SmartPedidos de los POS afectados
}</code></pre>

                    <h4>3.2.1. Mapeo de Plataformas (platformId y platformName)</h4>
                    <p>El backend de SmartCloud debe implementar un Enum o Diccionario Est√°tico para traducir el
                        SubCanal seleccionado en la UI (Punto 2.1) a los c√≥digos internos requeridos por la API de
                        SmartPedidos.</p>

                    <p><strong>Tabla de Referencia (Hardcoded):</strong></p>
                    <table>
                        <thead>
                            <tr>
                                <th>SubCanal (SmartCloud UI)</th>
                                <th>platformName (JSON)</th>
                                <th>platformId (JSON)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>PedidosYa</td><td>PedidosYa</td><td>1</td></tr>
                            <tr><td>Rappi</td><td>Rappi</td><td>2</td></tr>
                            <tr><td>Uber Eats</td><td>UberEats</td><td>4</td></tr>
                            <tr><td>PaD</td><td>PaD</td><td>5</td></tr>
                            <tr><td>Croni</td><td>Croni</td><td>6</td></tr>
                            <tr><td>PediGrido</td><td>PediGrido</td><td>7</td></tr>
                            <tr><td>Mercado Pago</td><td>MercadoPago</td><td>8</td></tr>
                            <tr><td>Glovo</td><td>Glovo</td><td>9</td></tr>
                            <tr><td>Toque</td><td>Toque</td><td>11</td></tr>
                            <tr><td>I+D</td><td>I+D</td><td>12</td></tr>
                        </tbody>
                    </table>
                    <p>Regla de Desarrollo: Si se agrega una nueva integraci√≥n en el futuro, se debe actualizar esta
                        tabla de mapeo en el backend de SmartCloud antes de habilitar el SubCanal en la UI.</p>

                    <h4>3.2.2. Resoluci√≥n de targetBranchIds</h4>
                    <p>Este array debe contener los IDs de autenticaci√≥n ("User") que identifican a cada sucursal dentro
                        del ecosistema de SmartPedidos.</p>
                    <p><strong>Fuente de Datos:</strong></p>
                    <ul>
                        <li>M√≥dulo: Franquicias > Puntos de Venta > Pesta√±a "Integraciones".</li>
                        <li>Campo Objetivo: El valor del input "User" ubicado dentro del bloque/toggle activado de Smart
                            Pedidos.</li>
                    </ul>

                    <p><strong>Algoritmo de Resoluci√≥n (Paso a Paso):</strong></p>
                    <ol>
                        <li>Disparador: El usuario presiona "Publicar" en la Lista de Precios (ej: ID 2).</li>
                        <li>Identificaci√≥n de Alcance (Query 1):
                            <ul>
                                <li>Buscar en la base de datos todos los Puntos de Venta (POS) que tengan asignada la
                                    PriceListId = 2 en su configuraci√≥n de "Datos Pos".</li>
                                <li>Resultado: Lista de objetos POS.</li>
                            </ul>
                        </li>
                        <li>Extracci√≥n de Credenciales (Query 2):
                            <ul>
                                <li>Para cada POS de la lista anterior, consultar su configuraci√≥n de Integraciones.
                                </li>
                                <li>Verificar si el toggle "Usar Smart Pedidos" est√° true.</li>
                                <li>Si est√° activo, leer el valor del campo "User" (Ej: 5129).</li>
                            </ul>
                        </li>
                        <li>Inyecci√≥n:
                            <ul>
                                <li>Agregar el valor 5129 al array targetBranchIds.</li>
                                <li>Repetir para todos los POS encontrados.</li>
                            </ul>
                        </li>
                    </ol>

                    <p><strong>Ejemplo de Flujo de Datos:</strong></p>
                    <p>Escenario: La "Lista C√≥rdoba" se usa en 2 locales.</p>
                    <ul>
                        <li>Local A (Centro): En Integraciones > Smart Pedidos > User tiene el valor 5129.</li>
                        <li>Local B (Cerro): En Integraciones > Smart Pedidos > User tiene el valor 5542.</li>
                    </ul>
                    <p>Resultado en JSON:</p>
<pre><code class="language-json">"targetBranchIds": [ 5129, 5542 ]</code></pre>
                    <p>Si un POS usa la lista de precios pero NO tiene activa la integraci√≥n con SmartPedidos (o el
                        campo User est√° vac√≠o), ese POS debe ser omitido del array targetBranchIds para evitar errores
                        de ruteo.</p>

                    <h3 id="det-3-3">3.3. Productos Unitarios (catalog)</h3>
                    <p>Esta secci√≥n contiene el inventario de productos en la Lista de Precios
                        /api/v1/PriceLists/GetPrices/{PriceListId}. A diferencia del endpoint mencionado que retorna un
                        array plano, el JSON de integraci√≥n requiere una para estandarizar el contenido.</p>

                    <h4>3.3.1. Estructura del Objeto</h4>
                    <p>Cada elemento del array catalog debe ser un objeto con dos propiedades obligatorias que no
                        existen en el modelo original:</p>
                    <ul>
                        <li>type: Identificador de tipo de objeto. Para esta secci√≥n, el valor fijo es "item".</li>
                        <li>data: Objeto contenedor donde se vuelcan las propiedades del producto.</li>
                    </ul>

                    <p>Esquema de Transformaci√≥n:</p>
<pre><code class="language-json">// Destino (Payload Unificado)
"catalog": [
  //item 1
  {
    "type": "item",       // Nuevo campo discriminador
    "data": { ... }       // Aqu√≠ van los datos mapeados de GetPrices del item
  },
  //item 2
  {
    "type": "item",       // Nuevo campo discriminador
    "data": { ... }       // Aqu√≠ van los datos mapeados de GetPrices del item
  }
]</code></pre>

                    <h4>3.3.2. Construcci√≥n del Objeto data</h4>
                    <p>La todos los campos (name, description, publishedPrice, enabled) se copian directamente del
                        objeto item original.
                        Sin embargo, los siguientes campos requieren una l√≥gica espec√≠fica:</p>

                    <p><strong>A. Nuevo Atributo: imageUrl (Resoluci√≥n Din√°mica)</strong></p>
                    <p>El backend debe calcular este campo teniendo en cuenta las modificaiones solicitadas en ‚ÄúGestion
                        Multimedia de Imagenes (Link):</p>
                    <ul>
                        <li>Leer el platformId del contexto (Ej: Id: 1 == "PedidosYa").</li>
                        <li>Buscar en la colecci√≥n de multimedia del √≠tem la imagen que tenga el tag coincidente (Ej:
                            Id: 1).</li>
                        <li>Resultado: Inyectar la URL encontrada en data.imageUrl.</li>
                    </ul>

                    <p><strong>B.Ejemplo de JSON Resultante</strong></p>
<pre><code class="language-json">"catalog": [
    {
      "type": "item",
      "data": {
        // Campos directos de GetPrices
        "itemId": 19,
        "name": "Agua Con Gas",
        "publishedPrice": 5000.00,
        "enabled": true,
        // Campos Nuevos
        "imageUrl": "https://cdn.smartcloud.com/images/peya/agua_gas_4x3.jpg", // Resuelto por Tag
      },
      {
      "type": "item",
      "data": {
        // Campos directos de GetPrices
        "itemId": 20,
        "name": "Agua Sin Gas",
        "publishedPrice": 5000.00,
        "enabled": true,
        // Campos Nuevos
        "imageUrl": "https://cdn.smartcloud.com/images/peya/agua_4x3.jpg", // Resuelto por Tag
      }
    }
]</code></pre>

                    <h3 id="det-3-4">3.4. Relaciones y Promociones (relations)</h3>
                    <p>Esta secci√≥n contiene las estructuras compuestas (Combos, Men√∫s). El backend debe construir este
                        array din√°micamente, obteniendo informaci√≥n de endpoints internos para generar el listado final.
                    </p>

                    <h4>3.4.1. L√≥gica de Agregaci√≥n y Filtrado (Backend)</h4>
                    <p>El servicio de publicaci√≥n debe ejecutar la siguiente secuencia l√≥gica para poblar este array:
                    </p>
                    <ul>
                        <li>Obtener Contexto: Leer el priceListId que se est√° publicando (Ej: 2) desde el contexto del
                            evento.</li>
                        <li>Consultar Universo de Promociones: Ejemplo:/business/promotions/ para obtener el listado .
                        </li>
                        <li>Filtrado : Iterar sobre las promociones y seleccionar √∫nicamente aquellas que tengan
                            asignado el priceListId (Ej: 2) actual en su configuraci√≥n.</li>
                        <li>Estandarizaci√≥n de Formato:
                            <ul>
                                <li>La data de la promoci√≥n seleccionada debe formatearse siguiendo el esquema del
                                    endpoint /api/v1/Promotion/GetByPOSCode.</li>
                                <li>Se deben aplicar las transformaciones de Imagen.</li>
                            </ul>
                        </li>
                    </ul>

                    <h4>3.4.2. Estructura del Array relations</h4>
                    <p>El array relations es una colecci√≥n de objetos. Cada objeto representa UNA promoci√≥n individual y
                        debe estar encapsulado con el discriminador de tipo.</p>

                    <p>Esquema del Array:</p>
<pre><code class="language-json">"relations": [
  // Promoci√≥n 1
  {
    "type": "promo",       // Discriminador fijo
    "data": { ... }        // Estructura id√©ntica a GetByPOSCode (Transformada)
  },
  // Promoci√≥n 2
  {
    "type": "promo",
    "data": { ... }
  },
  // Promoci√≥n N...
  {
    "type": "promo",
    "data": { ... }
  }
]</code></pre>

                    <h4>3.4.3. Ejemplo de JSON Resultante (Objeto Transformado)</h4>
                    <p>A continuaci√≥n se muestra c√≥mo se ve un objeto dentro del array relations una vez procesado.
                        Observar que data mantiene la estructura de GetByPOSCode pero con los valores (precios,
                        im√°genes, nombres) ya resueltos para la integraci√≥n.</p>

<pre><code class="language-json">"relations": [
    {
      "type": "promo",
      "data": {
        "id": 2,
        "cloudCodeId": "e3387769-02dd-4a81-aa4c-340b6627e674",
        "deleted": false,
        "name": "Combo 1 Peya",
        "description": "Combo 1 Peya",
        "quantity": 1,
        "imageUrl": null,
        "validSinceDate": "2025-09-25T00:00:00+00:00",
        "validToDate": "2027-04-30T00:00:00+00:00",
        "monday": true,
        "tuesday": true,
        "wednesday": true,
        "thursday": true,
        "friday": true,
        "saturday": true,
        "sunday": true,
        "holiday": true,
        "validSinceMinute": 0,
        "validToMinute": 1440,
        "groups": [
            {
                "name": "Hamburgesa",
                "id": 163,
                "amount": 1,
                "details": [
                    {
                        "id": 809,
                        "articleId": 9
                    },
                    {
                        "id": 810,
                        "articleId": 8
                    }
                ],
                "promotionGroupApply": [
                    {
                        "promotionApplyId": 65,
                        "promotionApply": {
                            "include": true,
                            "franchiseId": null,
                            "franchiseeId": null,
                            "cityId": null,
                            "provinceId": null,
                            "countryId": 11,
                            "regionId": null,
                            "priceListId": null
                        },
                        "promotionValue": 16900
                    }
                ],
                "type": "FixedPrice",
                "hasAdditionals": false,
                "defaultArticleId": 0,
                "multipleSelection": false
            },
            {
                "name": "Acompa√±amiento",
                "id": 164,
                "amount": 1,
                "details": [
                    {
                        "id": 811,
                        "articleId": 12
                    },
                    {
                        "id": 812,
                        "articleId": 29
                    }
                ],
                "promotionGroupApply": [
                    {
                        "promotionApplyId": 65,
                        "promotionApply": {
                            "include": true,
                            "franchiseId": null,
                            "franchiseeId": null,
                            "cityId": null,
                            "provinceId": null,
                            "countryId": 11,
                            "regionId": null,
                            "priceListId": null
                        },
                        "promotionValue": 0
                    }
                ],
                "type": "FixedPrice",
                "hasAdditionals": false,
                "defaultArticleId": 0,
                "multipleSelection": false
            },
            {
                "name": "Bebida",
                "id": 165,
                "amount": 1,
                "details": [
                    {
                        "id": 813,
                        "articleId": 4
                    },
                    {
                        "id": 814,
                        "articleId": 129
                    }
                ],
                "promotionGroupApply": [
                    {
                        "promotionApplyId": 65,
                        "promotionApply": {
                            "include": true,
                            "franchiseId": null,
                            "franchiseeId": null,
                            "cityId": null,
                            "provinceId": null,
                            "countryId": 11,
                            "regionId": null,
                            "priceListId": null
                        },
                        "promotionValue": 0
                    }
                ],
                "type": "FixedPrice",
                "hasAdditionals": false,
                "defaultArticleId": 0,
                "multipleSelection": false
            }
        ],
        "appliesTo": [
            {
                "include": true,
                "franchiseId": null,
                "franchiseeId": null,
                "cityId": null,
                "provinceId": null,
                "countryId": 11,
                "regionId": null,
                "priceListId": null
            }
        ],
        "franchiseAppliesTo": [],
        "suscriptions": [],
        "createdDate": "2025-09-25T17:59:10.1880684+00:00",
        "activatedDate": "2025-12-12T18:40:19.7666985+00:00",
        "deactivatedDate": null,
        "deactivatedNote": null,
        "mandatoryForAll": true,
        "promotionType": 1,
        "relationCodes": []
    },
    {
    "type": "promo",
      "data": {....}
    }
]</code></pre>

                  

                </section>
            </div>
        </main>
    </div>

    <script>
        // Syntax Highlighting Script for JSON
        document.addEventListener('DOMContentLoaded', () => {
            const codeBlocks = document.querySelectorAll('code.language-json');

            codeBlocks.forEach(block => {
                let html = block.innerHTML;

                // Regex for JSON syntax highlighting
                // Strings
                html = html.replace(/"([^"]*)"/g, '<span class="json-string">"$1"</span>');
                // Keys
                html = html.replace(/<span class="json-string">"([^"]*)"<\/span>:/g, '<span class="json-key">"$1"</span>:');
                // Numbers
                html = html.replace(/\b(\d+)\b/g, '<span class="json-number">$1</span>');
                // Booleans and Null
                html = html.replace(/\b(true|false)\b/g, '<span class="json-boolean">$1</span>');
                html = html.replace(/\b(null)\b/g, '<span class="json-null">$1</span>');
                // Comments (Simple single line //)
                html = html.replace(/(\/\/.*)/g, '<span class="json-comment">$1</span>');

                block.innerHTML = html;
            });
        });
    </script>
</body>

</html>
